!function(d,f,s,t){var o=/Mobi|Android/i.test(navigator.userAgent);var A=d("#siropuChat");var w=d("#siropuChatHeader");var C=d("#siropuChatTabs");var b=C.find('a[data-target="room-list"]');var i=C.find('a[data-target="conv-list"]');var j=C.find('a[data-target="conv-form"]');var v=d("#siropuChatContent");var D=d(".siropuChatMessages");var q=d("#siropuChatStartConversation");var r=d(".siropuChatConversation.siropuChatUsers");var k=d("#siropuChatNoConversations");var E=d("#siropuChatRooms");var B=d("#siropuChatSettings");var c=d("#siropuChatEditor");var h=d("#siropuChatWhosTyping");var a=c.find("form");var n=a.find('textarea[name="message_html"]');var m=a.find('button[type="submit"]');var y=d("#siropuChatBar");var x=d("#siropuChatBarMessageContainer");var p=d("#siropuChatBarUserCount span");var g=A.hasClass("siropuChatPage");var l=A.hasClass("siropuChatAllPages");var z=d(".siropuChatLogout");var e=d('a[data-nav-id="siropuChat"]');var u;XF.SiropuChat={};XF.SiropuChat.Core=XF.Element.newHandler({options:{active:false},userId:0,canUseChat:true,loggedIn:d("#XF").data("logged-in"),channel:"room",screenSize:"l",serverTime:0,pageFocus:true,pageTitle:d("title").text(),tabNotification:false,tabNotificationInterval:null,roomId:1,primaryRoomId:0,lastId:{},convId:0,convUnread:{},convOnly:0,convItems:[],guestRoom:0,noticeLastUpdate:0,userLastUpdate:0,convLastActive:0,convLastUpdate:0,userUpdateInterval:30,convUpdateInterval:60,messageDisplayLimit:25,notificationTimeout:5000,isVisible:A.is(":visible"),refreshActive:5000,refreshActiveHidden:15000,refreshInactive:30000,refreshInactiveHidden:60000,refreshInterval:0,refreshSet:null,inverse:0,floadCheck:0,roomFloodCheck:0,bypassFloodCheck:false,displayNavCount:false,forceRoom:false,inIframe:f.frameElement,dynamicTitle:true,activeUsers:{},commands:{},sounds:{},loadMoreButton:{room:true,conv:true},forceAutoScroll:false,joinCommand:null,loadRooms:false,internalLinksInNewTab:false,roomTabUserCount:true,enableRightNavLinkMobile:true,convTabCount:"onlineCount",userListOrder:"most_active",hideTabs:false,whosTyping:{room:false,conv:false},whosTypingInterval:null,init:function(){var G=this;if(!XF.Cookie.get("siropu_chat_channel")){XF.Cookie.set("siropu_chat_channel",this.channel);if(this.inRoom()){XF.Cookie.set("siropu_chat_room_id",d(".siropuChatRoom.siropuChatMessages:visible").data("room-id"))}else{XF.Cookie.set("siropu_chat_conv_id",d(".siropuChatConversation.siropuChatMessages:visible").data("conv-id"))}}n.on("editor:init",function(J,I){u=I});this.getScreenSize();this.startRefreshInterval();this._initSubmitForm();this._initTabs();this._initRoomListActions();this._initRoomActions();this._initConversations();this._initAutoScrollToggle();this._initSounds();this._initOnLoad();this._initWhosTyping();B.on("change",d.proxy(this,"saveSettings"));y.on("click",d.proxy(this,"toggleChat"));A.on("new-message",d.proxy(this,"newMessage"));if(l&&XF.siropuChatNoFooterPadding===undefined){d(".p-footer").css("padding-bottom",60)}if(o){d('textarea[name="message_html"]').on("editor:init",function(I,J){J.events.on("focus",function(L){var K=d(I.target);if(K.parents("#siropuChat").length==0&&l){y.fadeOut();setTimeout(function(){A.trigger("toggle-bar")},500)}});J.events.on("blur",function(L){var K=d(I.target);if(K.parents("#siropuChat").length==0&&l){y.fadeIn();setTimeout(function(){A.trigger("toggle-bar")},500)}})});if(this.enableRightNavLinkMobile&&d(".p-nav-menuTrigger").is(":visible")&&e.length&&!d(".p-navgroup-link--chat").length){var H=parseInt(e.find(".badge").text());var F=d('<a href="'+e.attr("href")+'" class="p-navgroup-link p-navgroup-link--chat" aria-label="Chat" title="Chat"><i class="far fa-comments"></i></a>');if(H){F.addClass("badgeContainer badgeContainer--highlighted").attr("data-badge",H)}F.insertAfter(".p-navgroup-link--whatsnew")}}d(f).scroll(function(){if(d(".p-navSticky").length&&d(".siropuChatAllPages.siropuChatMaximized").length){G.adjustContentHeight()}});d(f).resize(function(){if(o){return}G.getScreenSize();G.adjustContentHeight();G.adjustInputBox();if(G.inRoom()){if(C.length){G.switchRoom(G.roomId,true)}else{if(!G.getMiscSetting("hide_chatters")){var I=d('.siropuChatRoom.siropuChatUsers[data-room-id="'+G.roomId+'"]');if(G.screenSizeIs("s")){I.hide()}else{I.show()}}}}else{G.switchConversation(G.convId)}});d(f).blur(function(){G.pageFocus=false;if(!G.inIframe){G.clearWhosTypingInterval()}});d(f).focus(function(){G.pageFocus=true;if(G.tabNotificationInterval){clearInterval(G.tabNotificationInterval);d("title").text(G.pageTitle)}G._initWhosTyping()});d(s).on("keyup",function(I){if(I.which==27&&l&&G.isVisible){G.toggleChat()}});d(s).on("click",".siropuChatMessageRow.siropuChatBot ol li b",function(){G.editorSetHtml(d(this).html())});d(s).on("siropuChat:show-load-more",".siropuChatMessages",function(){if(G.inRoom()&&!G.loadMoreButton.room||G.inConv()&&!G.loadMoreButton.conv){return}if(d(this).find("> li[data-id]").length<G.messageDisplayLimit){return}var J=d('<li class="siropuChatLoadMoreMessages" style="display: none;" />');var I=d('<a class="button button--link" data-xf-click="siropu-chat-load-more-messages" />');I.html(XF.phrase("siropu_chat_load_more_messages")).appendTo(J);if(d(this).find(".siropuChatLoadMoreMessages").length){return d(this).find(".siropuChatLoadMoreMessages").fadeIn()}if(G.inverse){J.appendTo(d(this)).fadeIn();d(this).scrollTop(1000000)}else{J.prependTo(d(this)).fadeIn()}XF.activate(J)});d(s).on("click",function(I){if(l&&G.isVisible&&I.target.className.match("p-")){y.trigger("click")}});this.$target.on("mouseover mouseout",".siropuChatMessageRow",function(J){var K=d(this).find(".siropuChatMessageActions");var I=d(this).find(".siropuChatDateTime");if(K.length){if(J.type=="mouseover"){K.show();I.hide()}else{K.hide();I.show()}}});d(s).on("click",".siropuChatMessageText .link--internal",function(I){if(G.internalLinksInNewTab){I.preventDefault();f.open(d(this).attr("href"),"_blank")}});d("#siropuChatBarDisable").on("click",function(){d(this).find("i").removeClass("fa-toggle-off").addClass("fa-toggle-on");setTimeout(function(){B.find('input[name="disable"]').trigger("click")},1000)});setTimeout(function(){if(G.inRoom()&&G.loadRooms&&!G.getRoomCount()){b.click()}else{if(G.inConv()&&G.getConvCount()){r.find(".siropuChatActiveConversation").trigger("click",true)}}if(G.hasUnreadConversations()){G.addBarNewMessageClass()}},500);if(this.inRoom()&&this.isResponsive()){d(".siropuChatRoom.siropuChatUsers").hide()}if(this.inConv()){this.orderConversations()}if(this.lastId[this.roomId]===undefined){this.lastId[this.roomId]=1}this.joinCommand=this.getCommand("join");this.noticeLastUpdate=this.serverTime;this.userLastUpdate=this.serverTime;this.convLastUpdate=this.serverTime;this.convLastActive=this.serverTime;this.autoScroll();this.toggleLogout();this.toggleBotMessages()},getScreenSize:function(){if(f.matchMedia("(max-width: 768px)").matches){this.screenSize="s"}else{if(f.matchMedia("(max-width: 1024px)").matches){this.screenSize="m"}else{this.screenSize="l"}}},getRoomCount:function(){return A.find(".siropuChatMessages[data-room-id]").length},getConvCount:function(){return A.find("li[data-conv-id]").length},screenSizeIs:function(F){return this.screenSize==F},isResponsive:function(){return(this.screenSizeIs("s")||A.hasClass("siropuChatSidebar"))},newMessage:function(G,F){if(!this.pageFocus&&F.isSelf[this.roomId]===true){return}if(F.action!="join"){this.playSound(F);if(!this.pageFocus){this.displayTabNotification(F);this.initDesktopNotification(F)}}},doMessageActions:function(L){if(!L.actions){return}for(var G in L.actions){var J=L.actions[G];for(var Q in J){if(G=="rooms"&&this.lastId[Q]===undefined){continue}if(G=="rooms"){var F=d('.siropuChatMessages[data-room-id="'+Q+'"]')}else{var F=d('.siropuChatMessages[data-conv-id="'+Q+'"]')}for(var O in J[Q]){var I=J[Q][O];var R=F.find('> li[data-id="'+O+'"]');for(var P in I.action){if(R.attr("data-last-change")==I.action[P]){continue}switch(P){case"edit":R.find(".siropuChatMessageText").html(I.html);break;case"delete":R.fadeOut();break;case"like":var H=R.find(".siropuChatMessageLikes");if(H.length){if(I.likes){H.replaceWith(I.likes)}else{H.remove()}}else{R.find(".siropuChatMessageText").after(I.likes)}break;case"react":var N=R.find(".siropuChatReactions");var M=d(I.reactions);if(M){M.find(".siropuChatReactionView").replaceWith(XF.phrase("view"))}if(N.length){if(M){N.html(M)}else{N.remove()}}else{R.find(".siropuChatMessageText").after(M)}break;case"prune":if(I.prune){if(d.isNumeric(I.prune)){F.find('> li[data-user-id="'+I.prune+'"]').remove()}else{for(var K in I.prune){F.find('> li[data-id="'+I.prune[K]+'"]').remove()}}}else{F.find("> li").each(function(){if(d(this).data("id")<O){d(this).remove()}})}break}R.attr("data-last-change",I.action[P])}}}}},updateHeaderTitle:function(F){if(this.dynamicTitle){w.find("> span").text(F.data("title"))}},updateRooms:function(X){var V=false;var W=false;if(X.rooms===undefined){return}for(var F in X.rooms){var L=v.find('.siropuChatRoom.siropuChatMessages[data-room-id="'+F+'"]');var I=v.find('.siropuChatRoom.siropuChatUsers[data-room-id="'+F+'"]');var T=d(X.rooms[F]["messages"]);var P=X.rooms[F]["users"];var J=X.rooms[F]["userCount"];var U=C.find('a[data-room-id="'+F+'"]');var S=I.find(".siropuChatNoRoomUsers");if(this.activeUsers[F]===undefined){this.activeUsers[F]=[]}var R=false;if(X.inactiveRoomId!==undefined||X.action!="submit"&&(X.action=="join"||X.updateUsers)){if(J){for(var H in P){var M=P[H];var G=M.activity;var Q=M.status;var N=M.html;if(H){var Y=I.find('> li[data-user-id="'+H+'"]')}else{var Y=I.find('li[data-username="'+M.username+'"]')}if(N){if(Y.length){if(H==0){Y.find(".siropuChatActivityStatus").attr("data-status",G)}continue}if(S.length){I.html(N)}else{I.prepend(N)}if(H&&d.inArray(H,this.activeUsers[F])==-1){this.activeUsers[F].push(H);R=true}XF.activate(I)}else{if(Y.length){if(G=="inactive"){Y.remove();this.removeUserFromActiveUsers(F,H)}else{this.updateUser(Y,G,Q)}}}}if(this.userListOrder=="most_active"){R=true}}else{this.activeUsers[F]=[];this.addNoRoomUsersMessage(I)}if(this.roomTabUserCount){U.find("span").html(J).attr("class","siropuChatTabCount"+(J?"Active":"Inactive"))}W=true}if(T.length){T=d.grep(T,function(Z){return L.find('> li[data-id="'+d(Z).data("id")+'"]').length?false:true});if(this.inverse){L.prepend(T)}else{L.append(T)}this.delayAutoscroll(X,L);this.deleteOlderMessages(X.serverTime,L);if(!U.hasClass("siropuChatActiveTab")){U.addClass("siropuChatNewMessage")}if(d(T).length){V=true}XF.activate(d(".siropuChatRoom.siropuChatMessages > li"))}if(R){var O=I.find("> li").detach();switch(this.userListOrder){case"most_active":var K=O.sort(function(aa,Z){return d(aa).data("last-active")-d(Z).data("last-active")});break;case"alphabetically":var K=O.sort(function(aa,Z){return String.prototype.localeCompare.call(d(aa).data("username").toLowerCase(),d(Z).data("username").toLowerCase())});break}I.html(K)}}if(W){this.userLastUpdate=X.serverTime;this.updateNavUserCount(X)}this.updateLastId(X);this.updateRoomTabs(X);this.updateBar(X,W);if(V){X.channel="room";A.trigger("new-message",X)}},updateConversations:function(K){var P=this;var M=false;this.convUnread={};if(K.convContacts&&(K.action=="start"||K.updateConv)){if(this.convTabCount!="disabled"){i.find("span").html(K.convTabCount).attr("class","siropuChatTabCount"+(K.convTabCount?"Active":"Inactive"))}if(K.convItems!==undefined){this.convItems=K.convItems}for(var O in K.convContacts){var H=K.convContacts[O]["activity"];var I=K.convContacts[O]["status"];var L=K.convContacts[O]["html"];if(L){r.prepend(L);if(k.length){k.remove()}if(d.inArray(O,this.convItems)==-1){this.convItems.push(O)}}else{var N=r.find('> li[data-conv-id="'+O+'"]');if(N.length){this.updateUser(N,H,I)}}}this.convLastUpdate=K.serverTime}if(K.convMessages){for(var G in K.convMessages){var J=d(K.convMessages[G]);var F=d('.siropuChatConversation.siropuChatMessages[data-conv-id="'+G+'"]');if(F.length){J=d.grep(J,function(Q){return F.find('> li[data-id="'+d(Q).data("id")+'"]').length?false:true})}else{if(!this.convId||K.convId){F=this.createConversationMessageContainer(G);F.insertBefore(q);this.convId=K.convId?K.convId:G;setTimeout(function(){r.find('li[data-conv-id="'+P.convId+'"]').click()})}}if(this.inverse){F.prepend(J)}else{F.append(J)}XF.activate(d(".siropuChatConversation.siropuChatMessages > li"));this.delayAutoscroll(K,F);this.deleteOlderMessages(K.serverTime,F)}}if(K.convUnread){this.convUnread=K.convUnread;for(var G in K.convUnread){var N=r.find('li[data-conv-id="'+G+'"]');if(!N.hasClass("siropuChatNewMessage")){M=true}if(G!=this.convId){N.addClass("siropuChatNewMessage")}}if(this.inRoom()){i.addClass("siropuChatNewMessage")}}if(M){K.channel="conversation";A.trigger("new-message",K);this.addBarNewMessageClass();this.orderConversations()}},orderConversations:function(){if(r.find("li.siropuChatNewMessage").length){var G=r.find("> li").detach();var F=G.sort(function(I,H){return Number(d(H).hasClass("siropuChatNewMessage"))>Number(d(I).hasClass("siropuChatNewMessage"))?1:-1});r.html(F)}},hasUnreadConversations:function(){return !d.isEmptyObject(this.convUnread)},markCurrentConversationAsRead:function(){if(this.convUnread[this.convId]!==undefined){var F=this;XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/conversation/"+this.convId+"/mark-as-read"),{conv_unread:this.convUnread[this.convId]},function(G){if(G.convRead){delete F.convUnread[G.convRead];setTimeout(function(){d(".siropuChatConversation:visible .siropuChatMessageRow").removeClass("siropuChatUnread")},5000)}},{skipDefault:true,global:false})}},createRoomMessageContainer:function(F){return d('<ul class="siropuChatRoom siropuChatMessages" data-room-id="'+F+'" data-autoscroll="1" />')},createConversationMessageContainer:function(F){return d('<ul class="siropuChatConversation siropuChatMessages" data-conv-id="'+F+'" data-autoscroll="1" />')},updateNotice:function(G){var H=d("#siropuChatNotice");if(G.notice&&(G.serverTime-this.noticeLastUpdate>=60||!H.length)){var F=d(G.notice);if(H.length&&H.find("span").text()==F.find("span").text()){return}F.find("span").hide();if(H.length){H.replaceWith(F)}else{w.after(F)}setTimeout(function(){F.find("span").fadeIn()});this.noticeLastUpdate=G.serverTime}if(!G.notice&&H.length){H.remove()}},updateUser:function(G,K,F){G.find(".siropuChatActivityStatus").attr("data-status",K);var J=G.find(".siropuChatUserStatus");var I=J.length;if(F){if(I){J.html(F)}else{var H=d('<div class="siropuChatUserStatus" />');H.html(F).appendTo(G)}}else{if(I){J.remove()}}},updateActivityStatus:function(F){if(F.action!="submit"&&this.options.active!=F.active){this.options.active=F.active;A.attr("data-active",F.active);this.resetRefreshInterval()}},updateNavUserCount:function(H){if(!this.displayNavCount){return}var F=e.find("span.badge");F.text(H.userCount);if(H.userCount){F.addClass("badge--active")}else{F.removeClass("badge--active")}var G=d(".p-navgroup-link--chat");if(G.length){if(H.userCount){G.addClass("badgeContainer badgeContainer--highlighted")}else{G.removeClass("badgeContainer badgeContainer--highlighted")}G.attr("data-badge",H.userCount)}},updateBar:function(F,G){if(!(F.lastRow&&l)){return}x.html(F.lastRow.message);y.attr("data-room-id",F.lastRow.roomId);if(F.action!="submit"&&!this.getMiscSetting("hide_chatters")&&G){p.html(F.userCount)}},updateRoomTabs:function(G){if(this.forceRoom==true||this.loggedIn==false||G.joinedRooms===undefined){return}if(C.length){if(this.lastId&&G.joinedRooms){for(var F in this.lastId){if(d.inArray(Number(F),G.joinedRooms)==-1){this.leaveRoomPostActions(F)}}}else{if(this.getRoomCount()){this.postLogout()}}}},updateLastId:function(F){if(F.lastId===undefined||F.lastId.length===0){return}for(var G in F.lastId){this.lastId[G]=F.lastId[G]}},getRooms:function(){XF.ajax("GET",XF.canonicalizeUrl("index.php?chat/room/list"),{},function(F){if(F.html){XF.setupHtmlInsert(F.html,function(G,H,I){E.html(G)})}})},loadRoom:function(H){var F=this;var G=d(H.roomTab);if(this.getRoomCount()==0){G.removeClass("siropuChatActiveTab")}G.insertBefore(b);var I=this.createRoomMessageContainer(H.roomId);I.prependTo(v);this._initAutoScrollToggle(I);d('<ul class="siropuChatRoom siropuChatUsers" data-room-id="'+H.roomId+'" />').prependTo(v);if(H.action=="join"){this.lastId[H.roomId]=1}this.activeUsers[H.roomId]=H.userIds;this.updateRooms(H);setTimeout(function(){F.doAutoScroll(I)});this.switchRoom(H.roomId);this.toggleLogout()},leaveRoom:function(G){var F=this;var G=G?G:this.roomId;XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/room/"+G+"/leave"),{},function(H){F.leaveRoomPostActions(G)},{skipDefault:true})},leaveRoomPostActions:function(H,F){var J=A.find('[data-room-id="'+H+'"]');var G=C.find('[data-room-id="'+H+'"]');if(G.data("leave")==false){return false}J.remove();delete this.lastId[H];delete this.activeUsers[H];XF.Cookie.remove("siropu_chat_room_id");if(F){var I=C.find("[data-room-id]:last");if(I.length){I.click()}else{b.click()}}this.toggleLogout()},leaveConversationPostActions:function(F){A.find('[data-conv-id="'+F.convId+'"]').remove();this.convItems.splice(d.inArray(F.convId,this.convItems),1);XF.Cookie.remove("siropu_chat_conv_id");if(this.getConvCount()){r.find("li[data-conv-id]:first").click()}else{if(F.noConversations!==undefined){r.html(F.noConversations);XF.activate(r)}}},autoScroll:function(F){var F=F?F:D;if(F.attr("data-autoscroll")==1||this.forceAutoScroll){this.doAutoScroll(F)}},doAutoScroll:function(F){var F=F?F:D;if(this.inverse){F.scrollTop(0)}else{F.scrollTop(1000000)}},delayAutoscroll:function(H,G){var F=this;if(H.hasImages){setTimeout(function(){if(H.action=="submit"){F.doAutoScroll(G)}else{F.autoScroll(G)}},1500)}else{this.autoScroll(G)}},getSoundSetting:function(F){return B.find('input[name="sound['+F+']"]').is(":checked")},getNotificationSetting:function(F){return B.find('input[name="notification['+F+']"]').is(":checked")},getMiscSetting:function(F){return B.find('input[name="'+F+'"]').is(":checked")},getCommand:function(F){return this.commands[F]},getNotificationPhrase:function(G){var F=this.getMessageType(G);switch(F){case"mention":case"public":return XF.phrase("siropu_chat_new_public_message");break;case"private":return XF.phrase("siropu_chat_new_private_message");break;case"whisper":return XF.phrase("siropu_chat_new_whisper_message");break;default:return XF.phrase("siropu_chat_new_message");break}},getMessageType:function(F){return F.channel=="room"?F.lastRow.type:F.convLastRow.type},playSound:function(F){if(XF.isIOS()){return false}if(F.channel=="room"){var G=F.playSound}else{var G=F.convPlaySound}if(this.sounds[G]){this.sounds[G].play()}},initDesktopNotification:function(G){var F=this;if(!("Notification" in f)){return}if(!this.getNotificationSetting(this.getMessageType(G))){return}if(Notification.permission==="granted"){this.sendDesktopNotification(G)}else{if(Notification.permission!=="denied"){Notification.requestPermission(function(H){if(H==="granted"){F.sendDesktopNotification(G)}})}}},sendDesktopNotification:function(I){if(I.channel=="room"){var H=I.lastRow}else{var H=I.convLastRow}var G=this;var F={body:H.text,icon:H.avatar,tag:"siropuChatNotification"};var J=new Notification(this.getNotificationPhrase(I),F);setTimeout(J.close.bind(J),this.notificationTimeout);J.onclick=function(){this.close();f.focus();if(l&&G.isVisible){y.click()}else{G.switchRoom()}}},displayTabNotification:function(G){var F=this;if(this.tabNotification&&!this.tabNotificationInterval){this.tabNotificationInterval=setInterval(function(){d("title").text(d("title").text()==F.pageTitle?F.getNotificationPhrase(G):F.pageTitle)},1500)}},switchRoom:function(I,G){var H=C.find('a[data-room-id="'+I+'"]');var F=H.data("flood-check");this.roomFloodCheck=F?F:this.floodCheck;H.trigger("click",G)},switchConversation:function(F){r.find('li[data-conv-id="'+F+'"]').click()},preSubmit:function(){var F=this;if(XF.isEditorEnabled()){this.editorSetHtml("");this.editorOffPlaceholder("posting")}else{a.find('textarea[name="message"]').val("")}this.responseTimeout=setTimeout(function(){F.editorSetPlaceholder("noresponse");F.editorOn();F.startRefreshInterval()},5000);this.stopRefreshInterval()},postSubmit:function(){if(this.inRoom()&&!this.getRoomCount()||this.inConv()&&!this.getConvCount()){this.editorOffPlaceholder("")}else{this.editorOn();if(!o){this.editorFocus()}if(this.inRoom()){this.editorSetPlaceholder("public")}else{this.editorSetPlaceholder("private",r.find('li[data-conv-id="'+this.convId+'"]'))}}clearTimeout(this.responseTimeout);this.startRefreshInterval()},saveSettings:function(G){var F=this;if(!B.length){return}XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/save-settings"),B.serialize(),function(I){if(I.errorHtml){XF.setupHtmlInsert(I.errorHtml,function(J,K){var L=K.h1||K.title||XF.phrase("oops_we_ran_into_some_problems");XF.overlayMessage(L,J)});return true}var H="";if(G!==undefined){H=G.target.name}switch(H){case"inverse":F.inverse=F.getMiscSetting("inverse");F.autoScroll();break;case"maximized":A.toggleClass("siropuChatMaximized");F.adjustContentHeight();if(l&&!A.hasClass("siropuChatMaximized")){A.css("z-index","");v.css("height","")}break;case"display_mode":case"editor_on_top":if(H=="display_mode"&&g){return}XF.flashMessage(XF.phrase("siropu_chat_settings_change_reload_page"),3000);break;case"hide_bot":F.toggleBotMessages();break;case"hide_chatters":A.toggleClass("siropuChatHideUserList");break;case"disable":d("#siropuChatBar").remove();B.parents(".menu").remove();XF.flashMessage(XF.phrase("siropu_chat_has_been_disabled"),5000);XF.setupHtmlInsert(I.html,function(J,K){A.replaceWith(J)});A.trigger("disabled");break;default:if(H.match("sound")){F._initSounds()}break}},{skipDefault:true})},toggleChat:function(F){if(F.target.className.match("fa-")){return}A.toggle();x.toggle();this.isVisible=A.is(":visible");if(this.inRoom()){this.switchRoom(y.attr("data-room-id"))}if(this.inConv()&&this.isVisible&&this.hasUnreadConversations()){this.markCurrentConversationAsRead()}y.removeClass("siropuChatNewMessage");this.doAutoScroll();this.resetRefreshInterval();this.adjustContentHeight();if(!this.screenSizeIs("s")){this.editorFocus()}A.trigger("toggle",this.isVisible)},toggleAutoScroll:function(F){var H=parseInt(F[0].scrollHeight-F.innerHeight());var G=parseInt(F.scrollTop());F.attr("data-autoscroll",0);if(((G==H||G+1==H||G-1==H)&&!this.inverse)||G==0&&this.inverse){F.attr("data-autoscroll",1)}if(G==0&&!this.inverse||((G==H||G+1==H||G-1==H)&&this.inverse)){F.trigger("siropuChat:show-load-more")}},toggleLogout:function(){if(!z.length){return}var F=this.getRoomCount();var G=A.find('a[data-leave="false"]').length;if(F==0||(F-G)==0){z.fadeOut()}else{z.fadeIn()}},toggleBotMessages:function(){var F=d(".siropuChatRoom.siropuChatMessages > li.siropuChatBot");if(this.getMiscSetting("hide_bot")){F.fadeOut()}else{F.fadeIn()}},startRefreshInterval:function(){if(this.isVisible){if(this.options.active){this.refreshInterval=this.refreshActive}else{this.refreshInterval=this.refreshInactive}}else{if(this.options.active){this.refreshInterval=this.refreshActiveHidden}else{this.refreshInterval=this.refreshInactiveHidden}}this.refreshSet=setInterval(d.proxy(this,"refresh"),this.refreshInterval)},resetRefreshInterval:function(){this.stopRefreshInterval();var F=this;setTimeout(function(){F.startRefreshInterval()})},stopRefreshInterval:function(){clearInterval(this.refreshSet)},refresh:function(){var F=this;XF.ajax("GET",XF.canonicalizeUrl("index.php?chat/update"),{users:this.getUserList(),channel:this.channel,room_id:this.roomId,last_id:this.lastId,conv_id:this.convId,conv_unread:this.isVisible?this.convUnread:{},conv_only:this.convOnly,conv_items:this.getConvItems(),conv_last_active:this.convLastActive,conv_last_update:this.convLastUpdate,user_last_update:this.userLastUpdate,is_chat_page:g?1:0,hide_tabs:this.hideTabs?1:0},function(G){F.updateRooms(G);F.updateConversations(G);F.updateNotice(G);F.updateActivityStatus(G);setTimeout(function(){F.doMessageActions(G)})},{skipDefault:true,skipError:true,global:false})},getUserList:function(){var F={};for(var G in this.activeUsers){F[G]=this.activeUsers[G].join(",")}return F},getConvItems:function(){return this.convItems.join(",")},getLastConvId:function(){var F=d('.siropuChatConversation.siropuChatMessages[data-conv-id="'+this.convId+'"]');return F.find("> li:"+(this.inverse?"first":"last")).data("id")},adjustContentHeight:function(){var K=d(f).height();var F=A.height();var H=v.height();var J=y.height();var G=K-F;var I=20;if(d(".p-navSticky").length&&d(".p-navSticky.is-sticky").length){I+=d(".p-navSticky").height()}if(J){I+=J}if(d(".siropuChatAllPages.siropuChatMaximized").length){A.css("z-index",100);v.css("height",(H+G-I)+"px")}else{if(d("#siropuChatFullPage").length){v.css("height",(H+G)+"px")}}this.doAutoScroll()},adjustInputBox:function(){if(m.length&&d('html[dir="LTR"]').length){c.find(".fr-view").css("padding-right",m.outerWidth()+10)}},getFloodCheck:function(){if(this.bypassFloodCheck){return 0}if(this.inRoom()){return this.roomFloodCheck}else{return this.floodCheck}},editorFocus:function(){u.el.focus()},editorOn:function(){u.edit.on()},editorOff:function(){u.edit.off()},editorInsert:function(F){u.html.insert(F,true)},editorSetHtml:function(F){u.html.set(F);u.selection.setAfter("p");u.selection.restore();if(F){this.editorFocus()}},editorGetHtml:function(){return u.html.get(true)},editorGetText:function(){return d.trim(u.$el.text())},editorSetPlaceholder:function(G,F){var H=" ";switch(G){case"public":H=XF.phrase("siropu_chat_write_public_message");break;case"private":if(this.getConvCount()){H="("+F.data("username")+") "+XF.phrase("siropu_chat_write_private_message")}else{H=XF.phrase("siropu_chat_no_conversations_started")}break;case"posting":H=XF.phrase("siropu_chat_posting_message");break;case"wait":H=XF.phrase("siropu_chat_please_wait");break;case"readonly":H=XF.phrase("siropu_chat_room_is_read_only");break;case"noresponse":H=XF.phrase("siropu_chat_no_response");break;case"nopermission":H=XF.phrase("siropu_chat_do_not_have_permission_to_use");break}u.opts.placeholderText=H;u.placeholder.refresh()},editorOffPlaceholder:function(F){this.editorOff();this.editorSetPlaceholder(F)},editorOnPlaceholder:function(F){this.editorOn();this.editorSetPlaceholder(F)},loadSound:function(F){return this.sounds[F]?this.sounds[F]:new Audio(XF.canonicalizeUrl("styles/default/siropu/chat/sounds/"+F+".mp3"))},postLogout:function(){var F=this.getRoomCount();for(var G in this.lastId){this.leaveRoomPostActions(G,F!=0)}if(b.hasClass("siropuChatActiveTab")){this.getRooms()}else{if(!F){b.click()}}},setChannel:function(F){if(this.channel!=F){XF.Cookie.set("siropu_chat_channel",F);if(F=="room"){this.userUpdateInterval=30;this.convUpdateInterval=60}else{this.userUpdateInterval=60;this.convUpdateInterval=30}}this.channel=F},deleteOlderMessages:function(G,F){if(G-this.serverTime>=300&&F.find("> li[data-id]").length>=100&&F.data("autoscroll")==0){F.find(">li[data-id]:nth-child("+(this.inverse?"":"-")+"n+"+this.messageDisplayLimit+")").remove();this.serverTime=G}},getWhosTyping:function(){var F=this;XF.ajax("GET",XF.canonicalizeUrl("data/siropu/chat/"+this.channel+"/"+this.getChannelId()+".json"),{},function(J){var H=J?J:{};var K=[];for(var I in H){var G=H[I];if(I==F.userId){continue}if(Math.floor(Date.now()/1000)-G.t<=3){K.push(G.u)}}if(K.length){h.text(K.join(", ")+" "+XF.phrase("siropu_chat_is_typing")).fadeIn()}else{h.fadeOut()}},{skipDefault:true,skipError:true,global:false})},_initRoomListActions:function(){var F=this;d(s).on("click",".siropuChatRoomInfo h3",function(){var G=d(this).parents("li");if(G.data("joined")){F.switchRoom(G.data("room-id"))}else{G.find(".siropuChatRoomJoin").submit()}});d(s).on("submit",".siropuChatRoomAction form",function(I){I.preventDefault();var H=d(this).find('button[type="submit"]');var G=d(this).find('input[name="password"]');if(G.length){G.toggle().focus();if(!G.val()){return}}H.prop("disabled",true);setTimeout(function(){H.prop("disabled",false);G.val("")},1000);XF.ajax("POST",d(this).attr("action"),{password:G.val(),users:F.getUserList()},function(J){if(J.action=="join"){F.loadRoom(J)}if(J.action=="leave"){F.leaveRoomPostActions(J.roomId)}F.getRooms()})})},_initRoomActions:function(){var F=this;d(s).on("click",".siropuChatRecipients",function(){var G=d(this).data("recipients").split(", ");F.editorSetHtml("/"+F.getCommand("whisper")+" ["+G.join(", ")+"]&nbsp;")});d(s).on("click",".siropuChatTag, .siropuChatUserTag",function(G){var H=F.editorGetText();if(G.target.className.match("username")){G.preventDefault();var I=d(this).text()}else{var I=d(this).next("a").text()}if(H){F.editorInsert(" @"+I)}else{F.editorSetHtml("@"+I+",&nbsp;")}})},_initSubmitForm:function(){var F=this;n.on("editor:init",function(I,G){var H=n.data("buttons-remove");if(!XF.isEditorEnabled()&&H.match(/xfBbCode/)){XF.setIsEditorEnabled(true)}G.events.on("click",function(K){if(F.inConv()){var J=r.find('li[data-conv-id="'+F.convId+'"]');if(J.hasClass("siropuChatNewMessage")){J.removeClass("siropuChatNewMessage")}}});if(F.joinCommand){G.events.on("keyup",function(K){var M=F.editorGetText();var L=M.replace("/"+F.joinCommand,"").trim();if(M.match(/\/join/)&&L){var J=new XF.AutoCompleteResults({onInsert:function(N){F.editorSetHtml(M.replace(L,N));J.hideResults();a.submit()}});XF.ajax("GET",XF.canonicalizeUrl("index.php?chat/room/find"),{q:L},function(N){J.showResults(N.q,N.results,a)},{global:false,error:false})}})}if(!F.canUseChat){F.editorOffPlaceholder("nopermission")}else{if(F.inRoom()&&C.find('a[data-room-id="'+F.roomId+'"]').data("readonly")){F.editorOffPlaceholder("readonly")}else{if(F.inRoom()&&!F.getRoomCount()||F.inConv()&&!F.getConvCount()){F.editorOffPlaceholder("")}}}if(g&&!F.inIframe&&!F.screenSizeIs("s")){XF.EditorHelpers.focus(u)}setTimeout(function(){F.adjustContentHeight();F.adjustInputBox()})});a.on("submit",function(K){K.preventDefault();var H=F.editorGetHtml();var J=F.editorGetText();if(!XF.isEditorEnabled()){var G=c.find('textarea[name="message"]').val();H=G;J=G}if(!J&&!d(H).find("img").length){return F.editorSetHtml("")}var L=d('.siropuChatMessages[data-room-id="'+F.roomId+'"]');var I=d('.siropuChatUsers[data-room-id="'+F.roomId+'"]');F.preSubmit();XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/submit"),{users:F.getUserList(),channel:F.channel,room_id:F.roomId,last_id:F.lastId,conv_id:F.convId,conv_items:F.getConvItems(),conv_unread:F.convUnread,conv_last_id:F.getLastConvId(),message_html:H},function(M){if(M.roomIdle){I.find('> li[data-user-id="'+F.userId+'"]').remove();F.removeUserFromActiveUsers(F.roomId,F.userId);if(!F.activeUsers[F.roomId].length){F.addNoRoomUsersMessage(I)}F.postSubmit();return}if(M.input){F.editorSetHtml(M.input)}if(M.roomTab){F.loadRoom(M);F.postSubmit();return}if(M.find!==undefined){d(".siropuChatMessages:visible").html(d(M.messages)).attr("data-search",M.find);F.doAutoScroll();F.postSubmit();return}if(M.leaveRoom){F.leaveRoomPostActions(M.leaveRoom,true)}if(M.leaveConv){F.leaveConversationPostActions(M)}if(M.logout){F.postLogout()}if(M.html){XF.setupHtmlInsert(M.html,function(N,O){if(N.length){XF.overlayMessage(O.title,N)}})}if(M.prune){if(M.prune=="all"){d(".siropuChatMessages[data-room-id]").html("");F.lastId={}}else{if(M.prune=="room"){L.html("")}else{if(M.prune.user_id){L.find('> li[data-user-id="'+M.prune.user_id+'"]').remove()}else{if(M.prune.rows){if(F.inverse){L.find("> li").slice(0,Number(M.prune.rows)).remove()}else{L.find("> li").slice(Number(-M.prune.rows)).remove()}}}}}}if(M.sanctioned){I.find('> li[data-user-id="'+M.sanctioned+'"]').remove()}F.updateRooms(M);F.updateConversations(M);F.updateNotice(M);F.updateActivityStatus(M);if(F.getFloodCheck()){F.editorSetPlaceholder("wait")}setTimeout(function(){F.postSubmit()},F.getFloodCheck());if(F.inConv()){F.convLastActive=M.serverTime}},{global:false})})},_initTabs:function(){var F=this;C.on("click","a",function(I,G){I.preventDefault();d(this).removeClass("siropuChatNewMessage");v.find("> *").hide();C.find("a.siropuChatActiveTab").removeClass("siropuChatActiveTab");d(this).addClass("siropuChatActiveTab");F.editorSetPlaceholder("public");F.updateHeaderTitle(d(this));var H=d(this).data("target");F.setChannel(H.match(/room/)?"room":"conversation");switch(H){case"room":F.roomId=d(this).data("room-id");F.roomFloodCheck=d(this).data("flood-check");XF.Cookie.set("siropu_chat_room_id",F.roomId);v.find('[data-room-id="'+F.roomId+'"]').show();if(d(this).data("readonly")){F.editorOffPlaceholder("readonly")}else{F.editorOnPlaceholder("public")}if(F.isResponsive()){d(".siropuChatRoom.siropuChatUsers").hide()}else{if(!G){F.editorFocus()}}F.autoScroll();F._initWhosTyping();break;case"room-list":E.toggle();F.getRooms();F.editorOffPlaceholder("");F.clearWhosTypingInterval();break;case"conv-list":r.show();F.orderConversations();if(F.getConvCount()){r.find('li[data-conv-id="'+F.convId+'"]').trigger("click",true);F._initWhosTyping()}else{F.editorOffPlaceholder("");F.clearWhosTypingInterval()}break;case"conv-form":q.show();if(!F.screenSizeIs("s")){q.find("input").focus()}F.editorOffPlaceholder("");break}})},_initConversations:function(){var F=this;r.on("click","li[data-conv-id]",function(H,G){F.convId=d(this).data("conv-id");XF.Cookie.set("siropu_chat_conv_id",F.convId);F.updateHeaderTitle(d(this));d(this).removeClass("siropuChatNewMessage");d(".siropuChatConversation.siropuChatMessages").hide();d(this).addClass("siropuChatActiveConversation").siblings().removeClass("siropuChatActiveConversation");var J=d('.siropuChatConversation.siropuChatMessages[data-conv-id="'+F.convId+'"]');if(J.find("> li").length){J.show();F.autoScroll(J);F.markCurrentConversationAsRead()}else{var I=d('<li class="siropuChatLoadingMessages" />');I.html(XF.phrase("siropu_chat_loading_conversation_messages"));J=F.createConversationMessageContainer(F.convId);J.html(I).insertBefore(q).show();F._initAutoScrollToggle(J);XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/conversation/"+F.convId+"/load-messages"),{conv_unread:F.convUnread[F.convId]},function(K){J.html(K.messages);XF.activate(J);setTimeout(function(){F.doAutoScroll(J)})})}F.editorOn();F.editorSetPlaceholder("private",d(this));if(!F.inverse&&J.find("iframe").length){setTimeout(function(){F.autoScroll(J)},1000)}if(F.isResponsive()){if(G){J.hide()}else{r.hide()}}else{if(!G){F.editorFocus()}}});r.on("mouseover mouseout","> li",function(){d(this).find(".siropuChatConversationActions").toggle()})},_initOnLoad:function(){if(this.inverse){return}var F=this;d(".siropuChatMessages:visible .bbImage").on("load",function(){F.doAutoScroll()})},_initAutoScrollToggle:function(G){var F=this;var G=G?G:d(".siropuChatMessages");G.scroll(function(){F.toggleAutoScroll(d(this))})},_initSounds:function(){this.sounds.normal=this.getSoundSetting("normal")?this.loadSound("normal"):"";this.sounds.whisper=this.getSoundSetting("whisper")?this.loadSound("whisper"):"";this.sounds["private"]=this.getSoundSetting("private")?this.loadSound("private"):"";this.sounds.mention=this.getSoundSetting("mention")?this.loadSound("tag"):"";this.sounds.bot=this.getSoundSetting("bot")?this.loadSound("bot"):"";this.sounds.error=this.getSoundSetting("bot")?this.loadSound("error"):""},_initWhosTyping:function(){this.clearWhosTypingInterval();if(this.getChannelId()==0||this.inRoom()&&!this.whosTyping.room||this.inConv()&&!this.whosTyping.conv){return}var F=this;this.whosTypingInterval=setInterval(function(){F.getWhosTyping()},1000)},clearWhosTypingInterval:function(){clearInterval(this.whosTypingInterval);h.fadeOut()},getChannel:function(){return this.channel},getChannelId:function(){return this.inRoom()?this.roomId:this.convId},getRoomId:function(){return this.roomId},getConvId:function(){return this.convId},inRoom:function(){return this.channel=="room"},inConv:function(){return this.channel=="conversation"},escapeRegExp:function(F){return isNaN(F)?F.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"):F},addBarNewMessageClass:function(){if(l&&!this.isVisible){y.addClass("siropuChatNewMessage")}},removeUserFromActiveUsers:function(G,F){var H=this.activeUsers[G];this.activeUsers[G]=H.filter(function(I){return I!=F})},addNoRoomUsersMessage:function(F){F.html(d('<li class="siropuChatNoRoomUsers" />').html(XF.phrase("siropu_chat_no_one_is_chatting")))}});XF.SiropuChat.Form=XF.Element.newHandler({options:{edit:false,multiLine:false,timeTyping:Date.now()},init:function(){var H=this;var I=this.$target;var G=I.find("textarea");var F=XF.SiropuChat.Core.prototype;G.on("editor:init",function(K,J){J.opts.pastePlain=true;J.opts.multiLine=H.options.multiLine;J.opts.htmlAllowedTags=["img","a","table","tr","td","blockquote"];J.opts.heightMin=40;J.size.refresh();J.events.on("keydown",function(O){var M=XF.Cookie.get("siropu_chat_channel");if(O.which==13){if(H.options.multiLine&&O.shiftKey){return O.preventDefault()}I.submit();if(H.options.edit){I.find(".js-overlayClose").click()}}else{if(M=="room"&&F.whosTyping.room!==false||M=="conversation"&&F.whosTyping.conv!==false){var P=F.editorGetText();if(P.length>=2&&Math.floor(Date.now()/1000)-Math.floor(H.options.timeTyping/1000)>=1.5){var L=XF.Cookie.get("siropu_chat_room_id");var Q=XF.Cookie.get("siropu_chat_conv_id");var N=M=="room"?L:Q;XF.ajax("POST",XF.canonicalizeUrl("index.php?chat/"+M+"/"+N+"/typing"),{},function(R){},{skipDefault:true,skipError:true,global:false});H.options.timeTyping=Date.now()}}}});if(H.options.edit){setTimeout(function(){XF.EditorHelpers.focus(J)},500)}else{J.html.set("")}});d("#siropuChatEditor").on("keyup","textarea",function(J){if(J.which==13&&!XF.isEditorEnabled()&&!H.options.multiLine){I.submit()}})}});XF.SiropuChat.Messages=XF.Element.newHandler({options:{},init:function(){d('a[data-xf-click="siropu-chat-quote"]').remove();this.$target.on("mouseover mouseout",".siropuChatMessageRow",function(){if(d(this).find(".siropuChatMessageActions").length){d(this).find(".siropuChatDateTime, .siropuChatMessageActions").toggle()}})}});XF.SiropuChat.FindRooms=XF.Element.newHandler({options:{},init:function(){this.$target.on("keyup",function(){var G=d(this).val().trim();var F=new RegExp(G,"gi");d("#siropuChatRooms > li[data-room-name]").hide().each(function(){if(d(this).data("room-name").match(F)){d(this).show()}})})}});XF.SiropuChat.StartConversationForm=XF.Element.newHandler({options:{},init:function(){this.$target.on("submit",function(H){H.preventDefault();var G=d(this).find("input");var F=d(this).find("textarea");if(!G.val().trim()){return G.focus()}if(!F.val().trim()){return F.focus()}XF.ajax("POST",d(this).attr("action"),d(this).serialize()+"&conv_items="+XF.SiropuChat.Core.prototype.getConvItems(),function(I){k=d("#siropuChatNoConversations");if(k.length){k.remove()}XF.SiropuChat.Core.prototype.updateConversations(I);C.find('a[data-target="conv-list"]').click();G.val("");F.val("")})})}});XF.SiropuChat.LeaveConversation=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",d.proxy(this,"ajaxResponse"))},ajaxResponse:function(G,F){XF.SiropuChat.Core.prototype.updateConversations(F);XF.SiropuChat.Core.prototype.leaveConversationPostActions(F)}});XF.SiropuChat.Like=XF.Click.newHandler({eventNameSpace:"SiropuChatLike",init:function(){},click:function(G){G.preventDefault();var F=this;XF.ajax("POST",this.$target.attr("href"),function(H){if(H.html){XF.setupHtmlInsert(H.html,function(I,J,K){if(I.length){F.$target.parents(".siropuChatMessageRow").replaceWith(I)}})}})}});XF.SiropuChat.Unlike=XF.Click.newHandler({eventNameSpace:"SiropuChatUnlike",init:function(){},click:function(G){G.preventDefault();var F=this;XF.ajax("POST",this.$target.attr("href"),function(H){if(H.html){XF.setupHtmlInsert(H.html,function(I,J,K){if(I.length){F.$target.parents(".siropuChatMessageRow").replaceWith(I)}})}})}});XF.SiropuChat.Quote=XF.Click.newHandler({eventNameSpace:"SiropuChatQuote",init:function(){},click:function(F){F.preventDefault();XF.ajax("POST",this.$target.attr("href"),function(G){if(G.quote){XF.SiropuChat.Core.prototype.editorSetHtml(G.quote)}})}});XF.SiropuChat.LeaveRoom=XF.Click.newHandler({eventNameSpace:"SiropuChatLeaveRoom",init:function(){},click:function(G){G.preventDefault();var F=this;XF.ajax("POST",this.$target.attr("href"),function(H){XF.SiropuChat.Core.prototype.leaveRoomPostActions(H.roomId,true);F.$target.parent(".menu").toggle()})}});XF.SiropuChat.Whisper=XF.Click.newHandler({eventNameSpace:"SiropuChatWhisper",options:{username:""},init:function(){},click:function(M){var O=this.$target.parents(".menu").attr("id");var H=XF.SiropuChat.Core.prototype.editorGetText();var I=XF.SiropuChat.Core.prototype.getCommand("whisper");var F=[];F.push(this.options.username);if(H.match(/\[(.*?)\]/)){var P=H.indexOf("[");var J=H.indexOf("]");var L=H.substring(P+1,J);if(L.length){var N=L.split(",");for(var K in N){F.push(N[K].trim())}}if(L.match(XF.SiropuChat.Core.prototype.escapeRegExp(this.options.username))){F=F.filter(function(Q){return Q!=this.options.username})}}var G="";if(F.length){G="/"+I+" ["+F.join(", ")+"] "}XF.SiropuChat.Core.prototype.editorSetHtml(G+"&nbsp;")}});XF.SiropuChat.LoadMoreMessages=XF.Click.newHandler({eventNameSpace:"siropuChatLoadMoreMessages",init:function(){},click:function(I){I.preventDefault();var J=this.$target;if(J.data("complete")){return}var K=J.parents("ul.siropuChatMessages");var G=K.data("room-id");var L=K.data("conv-id");var N=K.attr("data-search");var H=XF.SiropuChat.Core.prototype.getMiscSetting("inverse");if(H){var M=K.find("> li[data-id]:last")}else{var M=K.find("> li[data-id]:first")}if(G){var F="room/"+G}else{var F="conversation/"+L}XF.ajax("GET",XF.canonicalizeUrl("index.php?chat/"+F+"/load-more-messages"),{message_id:M.data("id"),find:N},function(O){if(O.messages){if(H){M.after(O.messages)}else{M.before(O.messages).get(0).scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}XF.activate(M.parent())}if(!O.hasMore){J.attr("data-complete",true);J.html(XF.phrase("siropu_chat_all_messages_have_been_loaded"));setTimeout(function(){J.fadeOut()},5000)}})}});XF.SiropuChat.EditNotice=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",d.proxy(this,"ajaxResponse"))},ajaxResponse:function(G,F){if(F.message){XF.flashMessage(F.message,2000)}XF.SiropuChat.Core.prototype.updateNotice(F)}});XF.SiropuChat.ToggleUsers=XF.Click.newHandler({eventNameSpace:"siropuChatToggleUsers",init:function(){},click:function(H){var G=XF.SiropuChat.Core.prototype.getChannel();var F=XF.SiropuChat.Core.prototype.getRoomId();var I=XF.SiropuChat.Core.prototype.getConvId();if(G=="room"){d('.siropuChatUsers[data-room-id="'+F+'"]').toggle();d('.siropuChatMessages[data-room-id="'+F+'"]').toggle()}else{r.toggle();d('.siropuChatMessages[data-conv-id="'+I+'"]').toggle()}}});XF.SiropuChat.ToggleOptions=XF.Click.newHandler({eventNameSpace:"siropuChatToggleOptions",init:function(){},click:function(G){var F=this.$target.parents("fieldset").find("input");F.prop("checked",F.filter(":checked").length?false:true);B.change()}});XF.SiropuChat.ToggleConvForm=XF.Click.newHandler({eventNameSpace:"siropuChatToggleConvForm",init:function(){},click:function(G){var F=this.$target.parent(".siropuChatUserMenu").find("form");F.toggle();if(!XF.SiropuChat.Core.prototype.screenSizeIs("s")){F.find("textarea").focus()}}});XF.SiropuChat.ResetColor=XF.Click.newHandler({eventNameSpace:"SiropuChatResetColor",init:function(){},click:function(G){var F=B.find(".colorPickerBox");F.removeClass("is-active");F.find(".colorPickerBox-sample").attr("style","");B.find('input[name="message_color"]').val("");B.trigger("change")}});XF.SiropuChat.Logout=XF.Element.newHandler({options:{},init:function(){this.$target.on("ajax-submit:response",d.proxy(this,"ajaxResponse"))},ajaxResponse:function(G,F){if(F.errors||F.exception){return}G.preventDefault();if(F.message){XF.flashMessage(F.message,3000)}XF.SiropuChat.Core.prototype.postLogout()}});XF.SiropuChat.EditorButton={init:function(){XF.SiropuChat.EditorButton.initializeDialog();XF.EditorHelpers.dialogs.chat=new XF.SiropuChat.EditorDialogGallery("chat");if(d.FE.COMMANDS.xfCustom_chat){d.FE.COMMANDS.xfCustom_chat.callback=XF.SiropuChat.EditorButton.callback}},initializeDialog:function(){XF.SiropuChat.EditorDialogGallery=XF.extend(XF.EditorDialog,{cache:false,_init:function(H){var I=this;var G=H.$container;var F=G.find(".formSubmitRow-controls");d(".siropuChatDialogInsert").click(function(J){J.preventDefault();d(".js-attachmentFileSelected").each(function(){I.ed.image.insert(d(this).find("a").attr("href"))});I.overlay.hide()});G.on("click",".js-attachmentFile",function(){d(this).toggleClass("js-attachmentFileSelected");if(G.find(".js-attachmentFileSelected").length){F.fadeIn()}else{F.fadeOut()}})}})},callback:function(){XF.EditorHelpers.loadDialog(this,"chat")}};d(s).on("editor:first-start",XF.SiropuChat.EditorButton.init);XF.Element.register("siropu-chat","XF.SiropuChat.Core");XF.Element.register("siropu-chat-form","XF.SiropuChat.Form");XF.Element.register("siropu-chat-messages","XF.SiropuChat.Messages");XF.Element.register("siropu-chat-find-rooms","XF.SiropuChat.FindRooms");XF.Element.register("siropu-chat-start-conversation-form","XF.SiropuChat.StartConversationForm");XF.Element.register("siropu-chat-leave-conversation","XF.SiropuChat.LeaveConversation");XF.Element.register("siropu-chat-edit-notice","XF.SiropuChat.EditNotice");XF.Element.register("siropu-chat-logout","XF.SiropuChat.Logout");XF.Click.register("siropu-chat-like","XF.SiropuChat.Like");XF.Click.register("siropu-chat-unlike","XF.SiropuChat.Unlike");XF.Click.register("siropu-chat-quote","XF.SiropuChat.Quote");XF.Click.register("siropu-chat-whisper","XF.SiropuChat.Whisper");XF.Click.register("siropu-chat-leave-room","XF.SiropuChat.LeaveRoom");XF.Click.register("siropu-chat-load-more-messages","XF.SiropuChat.LoadMoreMessages");XF.Click.register("siropu-chat-toggle-users","XF.SiropuChat.ToggleUsers");XF.Click.register("siropu-chat-toggle-options","XF.SiropuChat.ToggleOptions");XF.Click.register("siropu-chat-toggle-conv-form","XF.SiropuChat.ToggleConvForm");XF.Click.register("siropu-chat-reset-color","XF.SiropuChat.ResetColor")}(jQuery,window,document);